# 斗兽棋 (Jungle Game)

传统中国棋类游戏"斗兽棋"的 Python 实现。

## 功能特性

✅ **完整的游戏规则**
- 8 种棋子及正确的等级系统（象、狮、虎、豹、狼、狗、猫、鼠）
- 特殊规则：鼠吃象、狮虎跳河、鼠能游泳
- 陷阱和兽穴机制
- 胜负条件（占领兽穴、无合法移动、50步规则、三次重复）

✅ **MVC 架构**
- 独立的 `model/`、`view/` 和 `controller/` 包
- Model 层完全独立于界面
- 符合所有规格要求

✅ **存档/读档系统**
- 以 JSON 格式保存游戏
- 加载之前的游戏继续进行
- 自动记录时间戳

✅ **撤销/重做** 
- 撤销最多 10 步
- 重做已撤销的移动
- 保存吃子状态

✅ **回放系统**
- 逐步浏览游戏历史
- 自动播放并可调速
- 跳转到指定步数

## 项目结构

```
JungleGame/
├── model/                  # Model 层（游戏逻辑）
│   ├── __init__.py
│   ├── piece.py           # 棋子类型和属性
│   ├── board.py           # 7×9 棋盘和地形
│   ├── move.py            # 移动验证
│   └── game_state.py      # 游戏状态管理
├── view/                   # View 层（显示）
│   ├── __init__.py
│   ├── cli_view.py        # 命令行界面
│   └── replay_engine.py   # 回放功能
├── controller/             # Controller 层
│   ├── __init__.py
│   └── game_controller.py # 主游戏控制器
├── main.py                 # 程序入口
├── test_game.py            # 单元测试
└── README.md               # 本文件
```

## 运行环境

- Python 3.7+
- 无需外部依赖（仅使用标准库）

## 安装说明

无需安装！直接运行即可：

```bash
python3 main.py
```

## 如何游玩

### 启动游戏

```bash
cd /Users/bits12/Desktop/JungleGame
python3 main.py
```

### 游戏命令

- **move <起点> <终点>** - 移动棋子
  - 示例：`move E3 E4`（将 E3 的棋子移动到 E4）
  
- **show <位置>** - 显示该位置棋子的合法移动
  - 示例：`show E3`（显示 E3 棋子可以移动到哪里）
  
- **undo** - 撤销上一步（最多 10 步）
  
- **redo** - 重做已撤销的移动
  
- **history** - 显示移动历史
  
- **save <文件名>** - 保存当前游戏
  - 示例：`save mygame`（保存为 mygame.json）
  
- **load <文件名>** - 加载已保存的游戏
  - 示例：`load mygame`（加载 mygame.json）
  
- **new** - 开始新游戏
  
- **replay** - 进入回放模式
  - 回放模式命令：
    - `next` 或 `n` - 前进一步
    - `prev` 或 `p` - 后退一步
    - `goto <数字>` - 跳转到指定步数
    - `play` - 自动播放剩余步数
    - `exit` 或 `e` - 退出回放模式
  
- **quit** - 退出游戏

### 棋盘坐标

- **列**：A-G（从左到右）
- **行**：1-9（从下到上，红方在底部）
- **位置示例**：E3, D1, G7

### 棋子符号

- **红方（小写）**：
  - `r` = 鼠，`c` = 猫，`d` = 狗，`w` = 狼
  - `l` = 豹，`t` = 虎，`n` = 狮，`e` = 象
  
- **蓝方（大写）**：
  - `R` = 鼠，`C` = 猫，`D` = 狗，`W` = 狼
  - `L` = 豹，`T` = 虎，`N` = 狮，`E` = 象

### 地形符号

- `·` = 普通陆地
- `≈` = 水域（河流）
- `△` = 陷阱
- `■` = 兽穴

## 游戏规则概要

### 移动规则
- 所有棋子每次移动 1 格（上/下/左/右，不能斜走）
- 狮和虎可以跳过河流（3 格宽）
- 只有鼠可以进入水域

### 吃子规则
- 高等级吃低等级或同等级
- **特殊**：鼠（等级 1）可以吃象（等级 8）
- **特殊**：象不能吃鼠
- 在对方陷阱中的棋子等级为 0（可被任何棋子吃掉）
- 水中的鼠不能被陆地棋子吃掉

### 获胜条件
1. 进入对方兽穴
2. 对方无合法移动

### 平局条件
1. 连续 50 步无吃子
2. 同一局面出现 3 次

## 测试

运行测试套件：

```bash
python3 test_game.py
```

测试覆盖：
- 棋盘初始化
- 基本移动
- 非法移动检测
- 特殊规则（鼠吃象）
- 水域移动
- 撤销/重做功能
- 存档/读档功能

## 游戏示例

```
$ python3 main.py

Enter command: move E3 E4
✓ 移动成功

Enter command: show G7
狮 at G7 的合法移动：
  G6
  F7

Enter command: move G7 G6

Enter command: history
--- 最近 10 步移动 ---
  1. RED 鼠 E3→E4
  2. BLUE 狮 G7→G6

Enter command: save game1
✓ 游戏已保存到 game1.json

Enter command: undo
✓ 移动已撤销

Enter command: replay
[进入回放模式，可逐步控制]
```

## 开发说明

### 代码风格
- 遵循 PEP8 规范
- 使用类型提示增强可读性
- 所有类和方法都有文档字符串

### 架构设计
- **Model 层**：纯游戏逻辑，无界面依赖
- **View 层**：显示和输入处理
- **Controller 层**：协调 Model 和 View

### 扩展点
- 可通过创建新 View 类轻松添加 GUI（tkinter）
- 可通过扩展 Controller 添加 AI 玩家
- 可通过扩展 Model 实现网络对战

## 规格符合度

本实现严格遵循项目规格文档：

- ✅ 完整游戏规则（§ 附录 B）
- ✅ 所有用户故事 US1-US10（§ 附录 C）
- ✅ MVC 架构，独立 model 包
- ✅ 仅使用标准库（无外部依赖）
- ✅ JSON 格式存档/读档
- ✅ 撤销/重做（10 层）
- ✅ 带控制的回放系统
- ✅ 移动历史记录
- ✅ 胜负/平局检测

